<!DOCTYPE html>
<html>
 
<head>
   <meta charset="utf-8">
	<script type="text/javascript" src="/ACM/js/link.js"></script>
	<title>splay</title>
</head>

<body>
	<div id = "myweb">
		
<!--    啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦-->
<script type="text/javascript" src="/ACM/js/up_and_right.js"></script>
<!--    啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦-->
		     
     		<div id="left">
     				<center><h1>splay</h1></center>
	
	
     			<div id="code">
     					<pre><span class="cp">#include&lt;bits/stdc++.h&gt;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">splay_tree</span><span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">maxn</span><span class="o">=</span><span class="mf">2e5</span><span class="o">+</span><span class="mi">10</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">INF</span><span class="o">=</span><span class="mf">2e9</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ch</span><span class="p">[</span><span class="n">maxn</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">fa</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">minv</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">key</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span> <span class="n">addv</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span> <span class="n">rev</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">siz</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="c1">//节点一共记录8个信息</span>
    <span class="kt">int</span> <span class="n">rab</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">sta</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span><span class="c1">//临时栈</span>
    <span class="kt">int</span> <span class="n">rab_</span><span class="p">,</span><span class="n">root</span><span class="p">,</span><span class="n">used</span><span class="p">,</span><span class="n">n</span><span class="p">;</span>
    <span class="c1">//数据结束</span>
    
    
    <span class="kt">void</span> <span class="n">maintain</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">){</span><span class="c1">//维持，回溯</span>
        <span class="kt">int</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">minv</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="n">minv</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">minv</span><span class="p">[</span><span class="n">h</span><span class="p">],</span> <span class="n">minv</span><span class="p">[</span><span class="n">l</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="n">minv</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">minv</span><span class="p">[</span><span class="n">h</span><span class="p">],</span> <span class="n">minv</span><span class="p">[</span><span class="n">r</span><span class="p">]);</span>
        <span class="c1">//minv[h] = min(minv[h], key[h]);</span>
        <span class="n">siz</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+</span> <span class="n">siz</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">pushdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">){</span><span class="c1">//下放懒惰标记</span>
        <span class="kt">int</span> <span class="o">&amp;</span><span class="n">l</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">r</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">]){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">addv</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
                <span class="n">key</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
                <span class="n">minv</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">addv</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
                <span class="n">key</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
                <span class="n">minv</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="n">h</span><span class="p">]){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="n">rev</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="n">rev</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">swap</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
            <span class="c1">//swap(l, r);</span>
            <span class="n">rev</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">rotate</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">){</span><span class="c1">//旋转</span>
        <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">h</span><span class="p">],</span> <span class="n">g</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">f</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="n">ch</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
            <span class="n">ch</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">fa</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span> <span class="n">fa</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">==</span><span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="o">!</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
        <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="o">!</span><span class="n">c</span><span class="p">];</span>
        <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="o">!</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="n">root</span><span class="p">)</span> <span class="n">root</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">push_road</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">){</span><span class="c1">//下放spaly整条路线的懒惰标记</span>
        <span class="kt">int</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">sta</span><span class="p">[</span><span class="n">top</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="n">h</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">sta</span><span class="p">[</span><span class="o">++</span><span class="n">top</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">h</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">rab_</span><span class="p">;</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="n">pushdown</span><span class="p">(</span><span class="n">sta</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    

    <span class="kt">void</span> <span class="n">splay</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">,</span><span class="kt">int</span> <span class="n">aim</span><span class="p">){</span><span class="c1">//伸展</span>
        <span class="n">push_road</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="n">h</span><span class="p">]</span><span class="o">^</span><span class="n">aim</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">h</span><span class="p">],</span> <span class="n">g</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[</span><span class="n">f</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="n">g</span><span class="o">^</span><span class="n">aim</span><span class="p">)</span> <span class="n">rotate</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
            <span class="n">rotate</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
    <span class="p">}</span>
    

    <span class="kt">void</span> <span class="n">newnode</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">,</span> <span class="kt">int</span> <span class="n">f</span><span class="p">,</span> <span class="kt">int</span> <span class="n">key_</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">rab_</span><span class="o">!=-</span><span class="mi">1</span><span class="p">)</span> <span class="n">h</span> <span class="o">=</span> <span class="n">rab</span><span class="p">[</span><span class="n">rab_</span><span class="o">--</span><span class="p">];</span><span class="c1">//如果rab是空的，我们就从rab里面找</span>
        <span class="k">else</span> <span class="n">h</span> <span class="o">=</span> <span class="o">++</span><span class="n">used</span><span class="p">;</span><span class="c1">//否则使用新的</span>
        
        <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mi">0</span><span class="p">;</span>
        <span class="n">fa</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
        
        <span class="n">minv</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">key_</span><span class="p">;</span>
        <span class="n">addv</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span><span class="n">rev</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">siz</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    

    <span class="kt">void</span> <span class="n">built</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">L</span><span class="p">,</span> <span class="kt">int</span> <span class="n">R</span><span class="p">,</span> <span class="kt">int</span> <span class="n">f</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">L</span> <span class="o">&lt;=</span> <span class="n">R</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">mi</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">R</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">newnode</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">mi</span><span class="p">]);</span>
            <span class="n">built</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">L</span><span class="p">,</span> <span class="n">mi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
            <span class="n">built</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">mi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
            <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">ini</span><span class="p">(</span><span class="kt">int</span> <span class="n">n_</span><span class="p">){</span>
        <span class="n">n</span><span class="o">=</span><span class="n">n_</span><span class="p">;</span>
        
        <span class="n">rab_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">used</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">newnode</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span><span class="c1">//哨兵</span>
        <span class="n">newnode</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">root</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">root</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span><span class="c1">//哨兵</span>
        
        <span class="n">built</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">root</span><span class="p">][</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="n">root</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">root</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
    <span class="p">}</span>
    
    
    <span class="kt">int</span> <span class="n">id</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">){</span><span class="c1">//返回第k个数，下标是从1开始的</span>
        <span class="kt">int</span> <span class="n">h</span><span class="p">;</span>
        <span class="n">pushdown</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="n">h</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span> <span class="n">siz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">k</span><span class="p">;){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">siz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="p">(</span><span class="n">siz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="n">pushdown</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">h</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//以上函数必备，尽量不要修改</span>
    <span class="c1">//////////////////////////</span>
    
    
    <span class="kt">int</span> <span class="n">getmin</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">minv</span><span class="p">[</span><span class="n">w</span><span class="p">];</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">key</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="n">newnode</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">del</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">rab</span><span class="p">[</span><span class="o">++</span><span class="n">rab_</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
        <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">key_</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">addv</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key_</span><span class="p">;</span>
        <span class="n">key</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key_</span><span class="p">;</span>
        <span class="n">minv</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key_</span><span class="p">;</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">reserve</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">id</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">rev</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    
    
    <span class="kt">void</span> <span class="n">revolve</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">,</span><span class="kt">int</span> <span class="n">t</span><span class="p">){</span>    <span class="c1">//移动的思想是基于反转区间的</span>
        <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">t</span> <span class="o">%=</span> <span class="n">w</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">t</span> <span class="o">+=</span> <span class="n">w</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">){</span>
            <span class="n">reserve</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">-</span><span class="n">t</span><span class="p">);</span>
            <span class="n">reserve</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
            <span class="n">reserve</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">tree</span><span class="p">;</span>


<span class="c1">//使用示例 hdu4453</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">maxn</span><span class="o">=</span><span class="mf">2e5</span><span class="o">+</span><span class="mi">10</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d %d %d %d &quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">,</span><span class="o">&amp;</span><span class="n">k1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">k2</span><span class="p">)){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">n</span><span class="o">==</span><span class="n">m</span><span class="o">&amp;&amp;</span><span class="n">n</span><span class="o">==</span><span class="n">k1</span><span class="o">&amp;&amp;</span><span class="n">n</span><span class="o">==</span><span class="n">k2</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>
        <span class="n">time</span><span class="o">++</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Case #%d:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">time</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="c1">/////////////////////////////////////////////////</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="n">tree</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
            <span class="c1">/////////////////////////////////////////////////</span>
        <span class="p">}</span>
        <span class="c1">/////////////////////////////////////////////////</span>
        <span class="n">tree</span><span class="p">.</span><span class="n">ini</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
        <span class="c1">/////////////////////////////////////////////////</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">cur</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">){</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;add&quot;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                <span class="c1">/////////////////////////////////////////////////</span>
                <span class="n">tree</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span><span class="n">cur</span><span class="o">+</span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="c1">//在区间【cur，cur+k2-1】值+x</span>
                <span class="c1">/////////////////////////////////////////////////</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;reverse&quot;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="c1">/////////////////////////////////////////////////</span>
                <span class="n">tree</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span><span class="n">cur</span><span class="o">+</span><span class="n">k1</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="c1">//在区间【cur，cur+k1-1】翻转</span>
                <span class="c1">/////////////////////////////////////////////////</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;insert&quot;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                <span class="c1">/////////////////////////////////////////////////</span>
                <span class="n">tree</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="c1">//在点cur加入x</span>
                <span class="c1">/////////////////////////////////////////////////</span>
                <span class="n">n</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;delete&quot;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="c1">/////////////////////////////////////////////////</span>
                <span class="n">tree</span><span class="p">.</span><span class="n">del</span><span class="p">(</span><span class="n">cur</span><span class="p">);</span><span class="c1">//删除点cur</span>
                <span class="c1">/////////////////////////////////////////////////</span>
                <span class="n">n</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                
                <span class="c1">/////////////////////////////////////////////////</span>
                <span class="n">tree</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="c1">//翻转区间【2，n+1】</span>
                <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">tree</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
                <span class="k">else</span> <span class="n">tree</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
                <span class="c1">/////////////////////////////////////////////////</span>
                
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="c1">/////////////////////////////////////////////////</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">tree</span><span class="p">.</span><span class="n">key</span><span class="p">[</span><span class="n">tree</span><span class="p">.</span><span class="n">id</span><span class="p">(</span><span class="n">cur</span><span class="p">)]);</span><span class="c1">//输出点cur的值</span>
                <span class="c1">/////////////////////////////////////////////////</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> </span>
<span class="cm"> 5 13 2 4</span>
<span class="cm"> 1 2 3 4 5</span>
<span class="cm"> move 2    23451</span>
<span class="cm"> query     2</span>
<span class="cm"> insert 8  283451</span>
<span class="cm"> reverse   823451</span>
<span class="cm"> query     8</span>
<span class="cm"> add 2     10 4 5 6 5 1</span>
<span class="cm"> query     10</span>
<span class="cm"> move 1    1 10 4 5 6 5</span>
<span class="cm"> query</span>
<span class="cm"> move 1</span>
<span class="cm"> query</span>
<span class="cm"> delete</span>
<span class="cm"> query</span>
<span class="cm"> </span>
<span class="cm"> */</span>
</pre>
     			</div>

     		</div>
     		
    </div>
</body>
</html>





