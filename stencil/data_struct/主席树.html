<!DOCTYPE html>
<html>
 
<head>
 <meta charset="utf-8">
	<script type="text/javascript" src="/ACM/js/link.js"></script>
	<title>主席树</title>
</head>

<body>
	<div id = "myweb">
		
<!--    啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦-->
<script type="text/javascript" src="/ACM/js/up_and_right.js"></script>
<!--    啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦啦-->
		     
     		     		<div id="left"><div id="left_in">
     			<center><h1>主席树</h1></center>
     			
     			<div id="text"></div>
     			
     			 <h3>纯净的主席树</h3>
     			<div id="code">
     
	<pre><span class="cm">/*</span>
<span class="cm"> void ini()//初始化主席树 O1</span>
<span class="cm"> void build(int _n)//建立一颗[1,_n]的主席树 Onlgn</span>
<span class="cm"> void update(int ql,int qr,int d)//主席树区间修改 Olgn</span>
<span class="cm"> int query(int ver,int ql,int qr)//主席树之前版本区间查询ver=0时为初始版本</span>
<span class="cm"> */</span>


<span class="cp">#define ml ((l+r)&gt;&gt;1)</span>
<span class="cp">#define mr (ml+1)</span>
<span class="k">struct</span> <span class="n">segment_tree</span><span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">maxn</span><span class="o">=</span><span class="mf">2e5</span><span class="p">;</span><span class="c1">// 空间复杂度约为 2*maxn+log(maxq)*maxq</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">rt_</span><span class="p">;</span><span class="c1">// rt_ -&gt; version</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">rt</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">sum</span><span class="p">[</span><span class="n">maxn</span><span class="o">*</span><span class="mi">20</span><span class="p">],</span><span class="n">lz</span><span class="p">[</span><span class="n">maxn</span><span class="o">*</span><span class="mi">20</span><span class="p">],</span><span class="n">ls</span><span class="p">[</span><span class="n">maxn</span><span class="o">*</span><span class="mi">20</span><span class="p">],</span><span class="n">rs</span><span class="p">[</span><span class="n">maxn</span><span class="o">*</span><span class="mi">20</span><span class="p">];</span>
    
    <span class="kt">void</span> <span class="n">cpy</span><span class="p">(</span><span class="kt">int</span> <span class="n">fm</span><span class="p">,</span><span class="kt">int</span> <span class="n">to</span><span class="p">){</span>
        <span class="n">sum</span><span class="p">[</span><span class="n">to</span><span class="p">]</span><span class="o">=</span><span class="n">sum</span><span class="p">[</span><span class="n">fm</span><span class="p">];</span><span class="n">lz</span><span class="p">[</span><span class="n">to</span><span class="p">]</span><span class="o">=</span><span class="n">lz</span><span class="p">[</span><span class="n">fm</span><span class="p">];</span>
        <span class="n">ls</span><span class="p">[</span><span class="n">to</span><span class="p">]</span><span class="o">=</span><span class="n">ls</span><span class="p">[</span><span class="n">fm</span><span class="p">];</span><span class="n">rs</span><span class="p">[</span><span class="n">to</span><span class="p">]</span><span class="o">=</span><span class="n">rs</span><span class="p">[</span><span class="n">fm</span><span class="p">];</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">pushdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">cur</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span><span class="c1">//因为那是以前的节点，不可以动他们的</span>
        <span class="n">cpy</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="n">cur</span><span class="p">],</span><span class="n">ls</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="n">ct</span><span class="o">++</span><span class="p">);</span>
        <span class="n">cpy</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">cur</span><span class="p">],</span><span class="n">rs</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="n">ct</span><span class="o">++</span><span class="p">);</span>
        <span class="n">lz</span><span class="p">[</span><span class="n">ls</span><span class="p">[</span><span class="n">cur</span><span class="p">]]</span><span class="o">+=</span><span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">];</span>
        <span class="n">lz</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">cur</span><span class="p">]]</span><span class="o">+=</span><span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">];</span>
        <span class="n">sum</span><span class="p">[</span><span class="n">ls</span><span class="p">[</span><span class="n">cur</span><span class="p">]]</span><span class="o">+=</span><span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ml</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">sum</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">cur</span><span class="p">]]</span><span class="o">+=</span><span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">mr</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">pushup</span><span class="p">(</span><span class="kt">int</span> <span class="n">cur</span><span class="p">){</span><span class="n">sum</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="n">sum</span><span class="p">[</span><span class="n">ls</span><span class="p">[</span><span class="n">cur</span><span class="p">]]</span><span class="o">+</span><span class="n">sum</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">cur</span><span class="p">]];}</span>
    <span class="kt">void</span> <span class="n">ini</span><span class="p">(){</span><span class="n">ct</span><span class="o">=</span><span class="n">rt_</span><span class="o">=</span><span class="mi">0</span><span class="p">;}</span><span class="c1">//初始化主席树</span>
    
    <span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">_n</span><span class="p">){</span><span class="c1">//建立一颗[1,_n]的主席树</span>
        <span class="n">n</span><span class="o">=</span><span class="n">_n</span><span class="p">;</span>
        <span class="n">rt</span><span class="p">[</span><span class="n">rt_</span><span class="o">++</span><span class="p">]</span><span class="o">=</span><span class="n">ct</span><span class="o">++</span><span class="p">;</span>
        <span class="n">build</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">rt_</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">cur</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
        <span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">r</span><span class="p">){</span>
            <span class="n">sum</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">build</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="n">ct</span><span class="o">++</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">ml</span><span class="p">);</span>
        <span class="n">build</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="n">ct</span><span class="o">++</span><span class="p">,</span><span class="n">mr</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
        <span class="n">pushup</span><span class="p">(</span><span class="n">cur</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span><span class="kt">int</span> <span class="n">qr</span><span class="p">,</span><span class="kt">int</span> <span class="n">d</span><span class="p">){</span>
        <span class="n">rt</span><span class="p">[</span><span class="n">rt_</span><span class="o">++</span><span class="p">]</span><span class="o">=</span><span class="n">ct</span><span class="o">++</span><span class="p">;</span>
        <span class="n">update</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">rt_</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">rt</span><span class="p">[</span><span class="n">rt_</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">pre</span><span class="p">,</span><span class="kt">int</span> <span class="n">cur</span><span class="p">,</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span><span class="kt">int</span> <span class="n">qr</span><span class="p">,</span><span class="kt">int</span> <span class="n">d</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
        <span class="n">cpy</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span><span class="n">cur</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ql</span><span class="o">&lt;=</span><span class="n">l</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">qr</span><span class="p">){</span>
            <span class="n">sum</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">+=</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">;</span>
            <span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">+=</span><span class="n">d</span><span class="p">;</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">])</span><span class="n">pushdown</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ml</span><span class="o">&gt;=</span><span class="n">ql</span><span class="p">)</span><span class="n">update</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="n">pre</span><span class="p">],</span><span class="n">ls</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="n">ct</span><span class="o">++</span><span class="p">,</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">ml</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mr</span><span class="o">&lt;=</span><span class="n">qr</span><span class="p">)</span><span class="n">update</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">pre</span><span class="p">],</span><span class="n">rs</span><span class="p">[</span><span class="n">cur</span><span class="p">]</span><span class="o">=</span><span class="n">ct</span><span class="o">++</span><span class="p">,</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">mr</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
        <span class="n">pushup</span><span class="p">(</span><span class="n">cur</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">ver</span><span class="p">,</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span><span class="kt">int</span> <span class="n">qr</span><span class="p">){</span><span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="n">rt</span><span class="p">[</span><span class="n">ver</span><span class="p">],</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);}</span>
    <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">cur</span><span class="p">,</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span><span class="kt">int</span> <span class="n">qr</span><span class="p">,</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ql</span><span class="o">&lt;=</span><span class="n">l</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">qr</span><span class="p">)</span><span class="k">return</span> <span class="n">sum</span><span class="p">[</span><span class="n">cur</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">ret</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lz</span><span class="p">[</span><span class="n">cur</span><span class="p">])</span><span class="n">pushdown</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ql</span><span class="o">&lt;=</span><span class="n">ml</span><span class="p">)</span><span class="n">ret</span><span class="o">+=</span><span class="n">query</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="n">cur</span><span class="p">],</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">ml</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">qr</span><span class="o">&gt;=</span><span class="n">mr</span><span class="p">)</span><span class="n">ret</span><span class="o">+=</span><span class="n">query</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">cur</span><span class="p">],</span><span class="n">ql</span><span class="p">,</span><span class="n">qr</span><span class="p">,</span><span class="n">mr</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="n">tree</span><span class="p">;</span>
</pre>
     			</div>
			
				<h3>主席树维护静态区间数据种类</h3>
				<div id ="code">
					
	<pre><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">tot</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="n">maxn</span><span class="p">],</span><span class="n">lson</span><span class="p">[</span><span class="n">maxn</span><span class="o">*</span><span class="mi">100</span><span class="p">],</span><span class="n">rson</span><span class="p">[</span><span class="n">maxn</span><span class="o">*</span><span class="mi">100</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="o">*</span><span class="mi">100</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="kt">int</span> <span class="n">r</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">root</span><span class="o">=</span><span class="n">tot</span><span class="o">++</span><span class="p">;</span>
    <span class="n">c</span><span class="p">[</span><span class="n">root</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">!=</span><span class="n">r</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">lson</span><span class="p">[</span><span class="n">root</span><span class="p">]</span><span class="o">=</span><span class="n">build</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
        <span class="n">rson</span><span class="p">[</span><span class="n">root</span><span class="p">]</span><span class="o">=</span><span class="n">build</span><span class="p">(</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">root</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">root</span><span class="p">,</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span><span class="kt">int</span> <span class="n">val</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">newroot</span><span class="o">=</span><span class="n">tot</span><span class="o">++</span><span class="p">,</span><span class="n">tmp</span><span class="o">=</span><span class="n">newroot</span><span class="p">;</span>
    <span class="n">c</span><span class="p">[</span><span class="n">newroot</span><span class="p">]</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">root</span><span class="p">]</span><span class="o">+</span><span class="n">val</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="n">n</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="n">r</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">){</span>
            <span class="n">lson</span><span class="p">[</span><span class="n">newroot</span><span class="p">]</span><span class="o">=</span><span class="n">tot</span><span class="o">++</span><span class="p">;</span><span class="n">rson</span><span class="p">[</span><span class="n">newroot</span><span class="p">]</span><span class="o">=</span><span class="n">rson</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
            <span class="n">newroot</span><span class="o">=</span><span class="n">lson</span><span class="p">[</span><span class="n">newroot</span><span class="p">];</span><span class="n">root</span><span class="o">=</span><span class="n">lson</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
            <span class="n">r</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="n">rson</span><span class="p">[</span><span class="n">newroot</span><span class="p">]</span><span class="o">=</span><span class="n">tot</span><span class="o">++</span><span class="p">;</span><span class="n">lson</span><span class="p">[</span><span class="n">newroot</span><span class="p">]</span><span class="o">=</span><span class="n">lson</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
            <span class="n">newroot</span><span class="o">=</span><span class="n">rson</span><span class="p">[</span><span class="n">newroot</span><span class="p">];</span><span class="n">root</span><span class="o">=</span><span class="n">rson</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
            <span class="n">l</span><span class="o">=</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">c</span><span class="p">[</span><span class="n">newroot</span><span class="p">]</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">root</span><span class="p">]</span><span class="o">+</span><span class="n">val</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">root</span><span class="p">,</span><span class="kt">int</span> <span class="n">pos</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">ret</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="n">n</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">pos</span><span class="o">&lt;</span><span class="n">r</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="o">&lt;=</span><span class="n">mid</span><span class="p">){</span>
            <span class="n">r</span><span class="o">=</span><span class="n">mid</span><span class="p">;</span>
            <span class="n">root</span><span class="o">=</span><span class="n">lson</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="n">ret</span><span class="o">+=</span><span class="n">c</span><span class="p">[</span><span class="n">lson</span><span class="p">[</span><span class="n">root</span><span class="p">]];</span>
            <span class="n">root</span><span class="o">=</span><span class="n">rson</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
            <span class="n">l</span><span class="o">=</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
    <span class="k">while</span><span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">tot</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
        <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
        <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="n">mp</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">mp</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">==</span><span class="n">mp</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span>
                <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">update</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="kt">int</span> <span class="n">tmp</span><span class="o">=</span><span class="n">update</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">mp</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">mp</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span><span class="c1">//记录最后一次出现的位置</span>
            <span class="c1">//也就是从i开始往右边数第一次出现的位置</span>
        <span class="p">}</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">q</span><span class="o">--</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">r</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">query</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="n">r</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//待更新</span>
</pre>
	
				</div>

     		</div>
     		
    </div>
</body>
</html>
